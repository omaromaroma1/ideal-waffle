<!DOCTYPE html>
<html lang="en">
<head>
<meta name="theme-color" content="#000000" />
<link rel="apple-touch-icon" href="/icon-192.png" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<link rel="manifest" href="/manifest.json" />
<meta name="theme-color" content="#0a6bff" />
<meta charset="UTF-8" />
<title>Money Budgeter</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="calculator-box">
    <div id="settings-icon" onclick="openSettings()">⚙️</div>
    <h1 id="title">Money Budgeter</h1>
    <div id="clock">🕒 --:--</div>
    <div id="budget">Budget: $0</div>
    <input id="input-display" placeholder="Enter amount" readonly />

    <div class="numpad">
      <button onclick="appendNumber('1')">1</button>
      <button onclick="appendNumber('2')">2</button>
      <button onclick="appendNumber('3')">3</button>
      <button onclick="appendNumber('4')">4</button>
      <button onclick="appendNumber('5')">5</button>
      <button onclick="appendNumber('6')">6</button>
      <button onclick="appendNumber('7')">7</button>
      <button onclick="appendNumber('8')">8</button>
      <button onclick="appendNumber('9')">9</button>
      <button onclick="appendNumber('0')">0</button>
      <button onclick="appendNumber('.')">.</button>
      <button onclick="backspace()">⌫</button>
    </div>

    <div class="buttons">
      <button id="addBtn" onclick="submitAmount('add')">Add</button>
      <button id="subtractBtn" onclick="openSubtract()">Subtract</button>
      <button id="clearBtn" onclick="clearHistory()">Clear History</button>
      <button id="resetBtn" onclick="resetBudget()">Reset</button>
      <button id="repeatBtn" onclick="location.href='repeat.html'">Repeat ➕</button>
      <button id="viewCatBtn" onclick="viewCategoryTotals()">📊 View Categories</button>
    </div>

    <div class="history-header">
      <div id="historyLabel">History</div>
      <button id="toggleHistoryBtn" class="history-toggle">Expand ⇵</button>
    </div>
    <div id="history"></div>
  </div>

  <div id="mode-toggle" onclick="toggleMode()">🌙</div>
  <button id="openAuth" class="auth-btn">👤 Sign In</button>
  <div id="overlay"></div>

  <!-- ✅ AUTH POPUP -->
  <div id="authSheet" class="auth-sheet">
    <div class="auth-head">
      <h3>Account</h3>
      <button id="authClose">✖</button>
    </div>
    <input id="emailInput" type="email" placeholder="Email" />
    <input id="passInput" type="password" placeholder="Password" />
    <button id="signInBtn">Sign In</button>
    <button id="signUpBtn">Sign Up</button>
    <button id="googleBtn">🔵 Sign in with Google</button>
    <input id="phoneInput" type="tel" placeholder="+974..." />
    <div id="recaptcha-container"></div>
    <button id="phoneBtn">📱 Sign in with Phone</button>
    <button id="resetBtnAuth">🔁 Forgot Password</button>
    <button id="signOutBtn">🚪 Sign Out</button>
    <div id="authMsg" style="margin-top:8px;font-size:0.9em;color:#ccc;"></div>
  </div>

  <!-- your existing JS for calculator etc. stays here -->
  <script src="main.js"></script>

  <!-- ✅ FIREBASE AUTH -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import {
      getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword,
      sendPasswordResetEmail, signOut, GoogleAuthProvider,
      signInWithPopup, RecaptchaVerifier, signInWithPhoneNumber
    } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDd2lvw5Bkts_ZYq6B_TdPVEE1PthTDcZk",
      authDomain: "money-budgeter.firebaseapp.com",
      projectId: "money-budgeter",
      storageBucket: "money-budgeter.appspot.com",
      messagingSenderId: "75231300827",
      appId: "1:75231300827:web:0ed7ad72f0c9647cdf10fe",
      measurementId: "G-J4ESLJBFVE"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const openAuth = document.getElementById("openAuth");
    const sheet = document.getElementById("authSheet");
    const closeBtn = document.getElementById("authClose");
    const msg = document.getElementById("authMsg");

    openAuth.onclick = () => sheet.style.display = "block";
    closeBtn.onclick = () => sheet.style.display = "none";

    // Email Sign Up
    document.getElementById("signUpBtn").onclick = async () => {
      const email = emailInput.value, pass = passInput.value;
      try {
        await createUserWithEmailAndPassword(auth, email, pass);
        msg.textContent = "Account created successfully ✅";
      } catch (e) {
        msg.textContent = e.message;
      }
    };

    // Email Sign In
    document.getElementById("signInBtn").onclick = async () => {
      const email = emailInput.value, pass = passInput.value;
      try {
        await signInWithEmailAndPassword(auth, email, pass);
        msg.textContent = "Signed in successfully ✅";
      } catch (e) {
        msg.textContent = e.message;
      }
    };

    // Google Sign In
    document.getElementById("googleBtn").onclick = async () => {
      try {
        await signInWithPopup(auth, provider);
        msg.textContent = "Google sign-in successful ✅";
      } catch (e) {
        msg.textContent = e.message;
      }
    };

    // Phone Sign In
    window.recaptchaVerifier = new RecaptchaVerifier(auth, "recaptcha-container", { size: "normal" });
    document.getElementById("phoneBtn").onclick = async () => {
      const phone = document.getElementById("phoneInput").value;
      try {
        const confirmationResult = await signInWithPhoneNumber(auth, phone, window.recaptchaVerifier);
        const code = prompt("Enter the verification code sent to your phone:");
        await confirmationResult.confirm(code);
        msg.textContent = "Phone number verified ✅";
      } catch (e) {
        msg.textContent = e.message;
      }
    };

    // Reset Password
    document.getElementById("resetBtnAuth").onclick = async () => {
      const email = emailInput.value;
      try {
        await sendPasswordResetEmail(auth, email);
        msg.textContent = "Reset link sent to your email ✅";
      } catch (e) {
        msg.textContent = e.message;
      }
    };

    // Sign Out
    document.getElementById("signOutBtn").onclick = async () => {
      await signOut(auth);
      msg.textContent = "Signed out 👋";
    };
  </script>
</body>
</html>
