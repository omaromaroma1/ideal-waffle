<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Money Budgeter</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0;transition:all .2s ease}
  body{font-family:Segoe UI,system-ui,Arial,sans-serif;padding:20px;transition:background .3s,color .3s}
  body.light-mode{background:#fff;color:#000}
  body.dark-mode{background:#121212;color:#eee}
  .calculator-box{width:360px;margin:0 auto;background:#f7f7f7;border-radius:20px;padding:20px;box-shadow:0 5px 15px rgba(0,0,0,.08);position:relative}
  body.dark-mode .calculator-box{background:#1e1e1e;box-shadow:0 5px 15px rgba(255,255,255,.05)}
  h1{text-align:center;margin-bottom:12px;color:#007bff}
  #clock,#budget,#renewal-summary,#renewal-next{text-align:center;margin:6px 0}
  #budget{font-size:2rem;font-weight:bold}
  .numpad,.buttons{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:12px 0}
  button{flex:1 1 45%;padding:12px;border:none;border-radius:12px;font-weight:600;background:#007bff;color:#fff;cursor:pointer}
  button:hover{background:#005ed6}
  .numpad button{flex:1 1 30%;padding:14px;background:#444;font-size:1.5rem}
  #input-display{width:100%;text-align:right;font-size:24px;padding:10px;border:none;background:transparent;color:inherit}

  .history-header{display:flex;align-items:center;justify-content:space-between;margin:6px 0 8px}
  .history-toggle{flex:0 0 auto;padding:6px 10px;border-radius:10px;font-size:12px;background:#e5f0ff;color:#0a3a8b;border:none}
  body.dark-mode .history-toggle{background:#243146;color:#d7e6ff}
  #history{max-height:220px;overflow:auto;background:#fff;border:1px solid #ccc;border-radius:12px;padding:10px}
  body.dark-mode #history{background:#2c2c2c;border-color:#666}

  #mode-toggle{position:fixed;right:16px;bottom:16px;font-size:26px;cursor:pointer}

  /* ---- Settings icon ---- */
  #settings-icon {
    position:absolute; top:10px; right:15px; font-size:22px; cursor:pointer;
    transition:transform .4s ease;
  }
  #settings-icon:hover { transform:rotate(90deg) scale(1.1); }

  /* ---- Centered modal ---- */
  #overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:9998}
  .modal{
    position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
    width:min(420px,92vw);max-height:85vh;overflow:auto;
    background:#ffffff;color:#111;border-radius:12px;padding:16px;
    box-shadow:0 20px 60px rgba(0,0,0,.35);display:none;z-index:9999;
  }
  body.dark-mode .modal{background:#1f2937;color:#e5e7eb}
  .modal h3{text-align:center;margin-bottom:10px}
  .modal .btn{display:block;width:100%;margin-bottom:8px;padding:10px;border:none;border-radius:10px;background:#007bff;color:#fff}
  .modal .btn:last-child{background:#aaa;color:#111}
  .modal label{display:flex;align-items:center;justify-content:space-between;margin:6px 0;padding:4px 0}

  /* ---- Sleek settings modal ---- */
  #settingsModal {
    animation: fadeIn 0.25s ease;
    border: none;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    background: linear-gradient(135deg, #ffffff 0%, #f7f7f7 100%);
  }
  body.dark-mode #settingsModal {
    background: linear-gradient(135deg, #1e1e1e 0%, #2b2b2b 100%);
  }
  #settingsModal h3, #settingsModal h4 {
    text-align: center;
    margin: 10px 0;
    color: #007bff;
  }
  #settingsModal .btn {
    border-radius: 10px;
    font-weight: 600;
    transition: transform .1s ease;
  }
  #settingsModal .btn:hover { transform: scale(1.03); }
  @keyframes fadeIn {
    from {opacity:0; transform:translate(-50%,-45%);}
    to {opacity:1; transform:translate(-50%,-50%);}
  }

  /* RTL for Arabic mode */
  body[dir="rtl"] { direction: rtl; text-align: right; }
  body[dir="rtl"] .calculator-box h1 { text-align: center; }
</style>
</head>
<body>
  <div class="calculator-box">
    <div id="settings-icon" onclick="openSettings()">‚öôÔ∏è</div>
    <h1 id="title">Money Budgeter</h1>
    <div id="clock">üïí Time: --:--</div>
    <div id="budget">Budget: $0</div>

    <div id="renewal-summary" style="font-size:12px;opacity:.85"></div>
    <div id="renewal-next" style="font-size:12px;opacity:.85"></div>

    <input id="input-display" placeholder="Enter amount" readonly/>

    <div class="numpad">
      <button onclick="appendNumber('1')">1</button><button onclick="appendNumber('2')">2</button><button onclick="appendNumber('3')">3</button>
      <button onclick="appendNumber('4')">4</button><button onclick="appendNumber('5')">5</button><button onclick="appendNumber('6')">6</button>
      <button onclick="appendNumber('7')">7</button><button onclick="appendNumber('8')">8</button><button onclick="appendNumber('9')">9</button>
      <button onclick="appendNumber('0')">0</button><button onclick="appendNumber('.')">.</button><button onclick="backspace()">‚å´</button>
    </div>

    <div class="buttons">
      <button id="addBtn" onclick="submitAmount('add')">Add</button>
      <button id="subtractBtn" onclick="openSubtract()">Subtract</button>
      <button id="clearBtn" onclick="clearHistory()">Clear History</button>
      <button id="resetBtn" onclick="resetBudget()">Reset</button>
      <button id="repeatBtn" onclick="location.href='repeat.html'">Repeat ‚ûï</button>
      <button id="viewCatBtn" onclick="viewCategoryTotals()">üìä View Categories</button>
    </div>

    <div class="history-header">
      <div style="font-weight:600" id="historyLabel">History</div>
      <button id="toggleHistoryBtn" class="history-toggle">Expand ‚áµ</button>
    </div>
    <div id="history"></div>
  </div>

  <!-- theme toggle -->
  <div id="mode-toggle" onclick="toggleMode()" aria-label="Toggle theme">üåô</div>

  <!-- overlay + settings modal -->
  <div id="overlay"></div>
  <div id="settingsModal" class="modal">
    <h3 id="settingsTitle">Settings</h3>
    <hr/>
    <h4 id="languageLabel">Language:</h4>
    <button class="btn" onclick="toggleLanguage()"><span id="langBtn">Switch to Arabic üá∏üá¶</span></button>

    <h4 id="featuresLabel">Features:</h4>
    <label><span id="toggleRepeatLbl">Show Repeat</span><input type="checkbox" id="toggleRepeat" checked/></label>
    <label><span id="toggleClearLbl">Show Clear History</span><input type="checkbox" id="toggleClear" checked/></label>
    <label><span id="toggleResetLbl">Show Reset</span><input type="checkbox" id="toggleReset" checked/></label>

    <h4 id="categoryLabel">Custom Categories:</h4>
    <div id="categoryList"></div>
    <input type="text" id="newCategoryInput" placeholder="Add new category" style="width:100%;padding:8px;border-radius:8px;margin-top:5px;"/>
    <button class="btn" onclick="addCategory()">Add Category</button>

    <button class="btn" onclick="closeSettings()">Close</button>
  </div>

<script>
const modeBtn=document.getElementById('mode-toggle');
const overlay=document.getElementById('overlay');
const settingsModal=document.getElementById('settingsModal');
let categories=JSON.parse(localStorage.getItem('categories'))||['Leisure','Transportation','Food','Groceries','Others','Games','Friends'];
let lang=localStorage.getItem('lang')||'en';
let featureSettings=JSON.parse(localStorage.getItem('featureSettings'))||{repeat:true,clear:true,reset:true};

function openSettings(){renderSettings();settingsModal.style.display='block';overlay.style.display='block';}
function closeSettings(){settingsModal.style.display='none';overlay.style.display='none';}
overlay.onclick=()=>closeSettings();

function renderSettings(){
  document.getElementById('toggleRepeat').checked=featureSettings.repeat;
  document.getElementById('toggleClear').checked=featureSettings.clear;
  document.getElementById('toggleReset').checked=featureSettings.reset;
  const list=document.getElementById('categoryList');
  list.innerHTML='';
  categories.forEach((c,i)=>{
    const row=document.createElement('div');
    row.innerHTML=`${c} <button style="float:right;background:red;color:#fff;border:none;border-radius:6px;padding:2px 6px;" onclick="removeCategory(${i})">X</button>`;
    list.appendChild(row);
  });
}

function addCategory(){
  const val=document.getElementById('newCategoryInput').value.trim();
  if(val && !categories.includes(val)){
    categories.push(val);
    localStorage.setItem('categories',JSON.stringify(categories));
    renderSettings();
    document.getElementById('newCategoryInput').value='';
  }
}

function removeCategory(i){
  categories.splice(i,1);
  localStorage.setItem('categories',JSON.stringify(categories));
  renderSettings();
}

document.getElementById('toggleRepeat').onchange=()=>{
  featureSettings.repeat=document.getElementById('toggleRepeat').checked;
  document.getElementById('repeatBtn').style.display=featureSettings.repeat?'':'none';
  localStorage.setItem('featureSettings',JSON.stringify(featureSettings));
};
document.getElementById('toggleClear').onchange=()=>{
  featureSettings.clear=document.getElementById('toggleClear').checked;
  document.getElementById('clearBtn').style.display=featureSettings.clear?'':'none';
  localStorage.setItem('featureSettings',JSON.stringify(featureSettings));
};
document.getElementById('toggleReset').onchange=()=>{
  featureSettings.reset=document.getElementById('toggleReset').checked;
  document.getElementById('resetBtn').style.display=featureSettings.reset?'':'none';
  localStorage.setItem('featureSettings',JSON.stringify(featureSettings));
};

// === Language toggle ===
function toggleLanguage(){
  lang=lang==='en'?'ar':'en';
  localStorage.setItem('lang',lang);
  applyLanguage();
}
function applyLanguage(){
  const en={title:'Money Budgeter',settingsTitle:'Settings',languageLabel:'Language:',featuresLabel:'Features:',
    categoryLabel:'Custom Categories:',toggleRepeatLbl:'Show Repeat',toggleClearLbl:'Show Clear History',
    toggleResetLbl:'Show Reset',langBtn:'Switch to Arabic üá∏üá¶',historyLabel:'History'};
  const ar={title:'ŸÖÿØŸäÿ± ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ©',settingsTitle:'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',languageLabel:'ÿßŸÑŸÑÿ∫ÿ©:',featuresLabel:'ÿßŸÑÿÆÿµÿßÿ¶ÿµ:',
    categoryLabel:'ÿßŸÑŸÅÿ¶ÿßÿ™ ÿßŸÑŸÖÿÆÿµÿµÿ©:',toggleRepeatLbl:'ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÉÿ±ÿßÿ±',toggleClearLbl:'ÿπÿ±ÿ∂ ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ',
    toggleResetLbl:'ÿπÿ±ÿ∂ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑',langBtn:'ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ© üá¨üáß',historyLabel:'ÿßŸÑÿ≥ÿ¨ŸÑ'};
  const t=lang==='ar'?ar:en;
  document.getElementById('title').textContent=t.title;
  document.getElementById('settingsTitle').textContent=t.settingsTitle;
  document.getElementById('languageLabel').textContent=t.languageLabel;
  document.getElementById('featuresLabel').textContent=t.featuresLabel;
  document.getElementById('categoryLabel').textContent=t.categoryLabel;
  document.getElementById('toggleRepeatLbl').textContent=t.toggleRepeatLbl;
  document.getElementById('toggleClearLbl').textContent=t.toggleClearLbl;
  document.getElementById('toggleResetLbl').textContent=t.toggleResetLbl;
  document.getElementById('langBtn').textContent=t.langBtn;
  document.getElementById('historyLabel').textContent=t.historyLabel;
  document.body.setAttribute('dir',lang==='ar'?'rtl':'ltr');
}
applyLanguage();

// === View Categories ===
function viewCategoryTotals() {
  const totals = Object.fromEntries(categories.map(c => [c, 0]));
  history.forEach(h => {
    const match = h.type.match(/^Subtract \((.+)\)$/);
    if (match && totals[match[1]] !== undefined) totals[match[1]] += h.value;
  });
  const cur = localStorage.getItem('currency') || '$';
  let html = `<h3>${lang === 'ar' ? 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÅÿ¶ÿßÿ™' : 'Category Totals'}</h3>`;
  html += categories.map(c => `<div style="margin:6px 0;">${c}: ${cur}${totals[c].toFixed(2)}</div>`).join('');
  html += `<button class="btn" onclick="closeSettingsModal()">${lang === 'ar' ? 'ÿ•ÿ∫ŸÑÿßŸÇ' : 'Close'}</button>`;
  const modal = document.createElement('div');
  modal.className = 'modal sleek-modal';
  modal.innerHTML = html;
  document.body.appendChild(modal);
  modal.style.display = 'block';
  overlay.style.display = 'block';
}
function closeSettingsModal() {
  document.querySelectorAll('.sleek-modal').forEach(m => m.remove());
  overlay.style.display = 'none';
}

// === Dark mode toggle ===
function toggleMode() {
  const dark = document.body.classList.contains('dark-mode');
  document.body.classList.toggle('dark-mode', !dark);
  document.body.classList.toggle('light-mode', dark);
  localStorage.setItem('theme', dark ? 'light' : 'dark');
  modeBtn.textContent = dark ? 'üåô' : '‚òÄÔ∏è';
}
if (localStorage.getItem('theme') === 'dark') {
  document.body.classList.add('dark-mode');
  modeBtn.textContent = '‚òÄÔ∏è';
} else {
  document.body.classList.add('light-mode');
}

// === Expand History ===
function openFullHistory() {
  const overlayDiv = document.createElement('div');
  overlayDiv.id = 'historyOverlay';
  overlayDiv.style.position = 'fixed';
  overlayDiv.style.inset = '0';
  overlayDiv.style.background = 'rgba(0,0,0,.7)';
  overlayDiv.style.display = 'flex';
  overlayDiv.style.justifyContent = 'center';
  overlayDiv.style.alignItems = 'center';
  overlayDiv.style.zIndex = '9999';
  const panel = document.createElement('div');
  panel.style.width = '90%';
  panel.style.maxWidth = '600px';
  panel.style.maxHeight = '90vh';
  panel.style.overflowY = 'auto';
  panel.style.borderRadius = '16px';
  panel.style.background = document.body.classList.contains('dark-mode') ? '#1f2937' : '#fff';
  panel.style.color = document.body.classList.contains('dark-mode') ? '#eee' : '#111';
  panel.style.padding = '16px';
  panel.innerHTML =
    '<h3 style="text-align:center;margin-bottom:10px;">' +
    (lang === 'ar' ? 'ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑŸÉÿßŸÖŸÑ' : 'Full History') +
    '</h3>' +
    history
      .slice()
      .reverse()
      .map(it => `<div style="padding:6px 0;border-bottom:1px solid rgba(0,0,0,.1);">${it.timestamp} ‚Äî ${it.type}: $${it.value.toFixed(2)}</div>`)
      .join('') +
    `<button class="btn" style="margin-top:10px;width:100%;" onclick="document.getElementById('historyOverlay').remove()">${lang === 'ar' ? 'ÿ•ÿ∫ŸÑÿßŸÇ' : 'Close'}</button>`;
  overlayDiv.appendChild(panel);
  document.body.appendChild(overlayDiv);
}
document.getElementById('toggleHistoryBtn').addEventListener('click', openFullHistory);

// === Main logic ===
const inputEl=document.getElementById('input-display');
let budget=parseFloat(localStorage.getItem('budget'))||0;
let history=JSON.parse(localStorage.getItem('history'))||[];
function appendNumber(n){inputEl.value+=n;}
function backspace(){inputEl.value=inputEl.value.slice(0,-1);}
function clearInput(){inputEl.value='';}
function submitAmount(type){
  const v=parseFloat(inputEl.value);if(isNaN(v))return;
  const ts=new Date().toLocaleString();
  if(type==='add'){budget+=v;history.push({type:'Add',value:v,timestamp:ts});}
  saveBudget();renderHistory();clearInput();
}
function openSubtract(){
  const modal=document.createElement('div');
  modal.className='modal';
  modal.innerHTML
