<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Money Budgeter</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="calculator-box">
    <div id="settings-icon" onclick="openSettings()">âš™ï¸</div>
    <h1 id="title">Money Budgeter</h1>
    <div id="clock">ğŸ•’ Time: --:--</div>
    <div id="budget">Budget: $0</div>

    <input id="input-display" placeholder="Enter amount" readonly />

    <div class="numpad">
      <button onclick="appendNumber('1')">1</button>
      <button onclick="appendNumber('2')">2</button>
      <button onclick="appendNumber('3')">3</button>
      <button onclick="appendNumber('4')">4</button>
      <button onclick="appendNumber('5')">5</button>
      <button onclick="appendNumber('6')">6</button>
      <button onclick="appendNumber('7')">7</button>
      <button onclick="appendNumber('8')">8</button>
      <button onclick="appendNumber('9')">9</button>
      <button onclick="appendNumber('0')">0</button>
      <button onclick="appendNumber('.')">.</button>
      <button onclick="backspace()">âŒ«</button>
    </div>

    <div class="buttons">
      <button id="addBtn" onclick="submitAmount('add')">Add</button>
      <button id="subtractBtn" onclick="openSubtract()">Subtract</button>
      <button id="clearBtn" onclick="clearHistory()">Clear History</button>
      <button id="resetBtn" onclick="resetBudget()">Reset</button>
      <button id="repeatBtn" onclick="location.href='repeat.html'">Repeat â•</button>
      <button id="viewCatBtn" onclick="viewCategoryTotals()">ğŸ“Š View Categories</button>
    </div>

    <div class="history-header">
      <div id="historyLabel">History</div>
      <button id="toggleHistoryBtn" class="history-toggle">Expand â‡µ</button>
    </div>
    <div id="history"></div>
  </div>

  <div id="mode-toggle" onclick="toggleMode()">ğŸŒ™</div>

  <!-- Settings Modal -->
  <div id="overlay"></div>
  <div id="settingsModal" class="modal">
    <h3 id="settingsTitle">Settings</h3>
    <hr />
    <h4 id="languageLabel">Language:</h4>
    <button class="btn" onclick="toggleLanguage()">
      <span id="langBtn">Switch to Arabic ğŸ‡¸ğŸ‡¦</span>
    </button>

    <h4 id="featuresLabel">Features:</h4>
    <label><span id="toggleRepeatLbl">Show Repeat</span><input type="checkbox" id="toggleRepeat" checked /></label>
    <label><span id="toggleClearLbl">Show Clear History</span><input type="checkbox" id="toggleClear" checked /></label>
    <label><span id="toggleResetLbl">Show Reset</span><input type="checkbox" id="toggleReset" checked /></label>

    <h4 id="categoryLabel">Custom Categories:</h4>
    <div id="categoryList"></div>
    <input type="text" id="newCategoryInput" placeholder="Add new category" />
    <button class="btn" onclick="addCategory()">Add Category</button>
    <button class="btn" onclick="closeSettings()">Close</button>
  </div>

<script>
const modeBtn = document.getElementById('mode-toggle');
const overlay = document.getElementById('overlay');
const settingsModal = document.getElementById('settingsModal');
const historyEl = document.getElementById('history');
let categories = JSON.parse(localStorage.getItem('categories')) || ['Leisure','Transportation','Food','Groceries','Others','Games','Friends'];
let lang = localStorage.getItem('lang') || 'en';
let featureSettings = JSON.parse(localStorage.getItem('featureSettings')) || { repeat:true, clear:true, reset:true };
let budget = parseFloat(localStorage.getItem('budget')) || 0;
let history = JSON.parse(localStorage.getItem('history')) || [];

// ========== Clock ==========
function tickClock() {
  const n = new Date();
  document.getElementById('clock').textContent = 'ğŸ•’ ' + n.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
}
setInterval(tickClock, 1000);
tickClock();

// ========== Calculator ==========
const inputEl = document.getElementById('input-display');
function appendNumber(n){inputEl.value+=n;}
function backspace(){inputEl.value=inputEl.value.slice(0,-1);}
function clearInput(){inputEl.value='';}
function submitAmount(type){
  const v=parseFloat(inputEl.value);
  if(isNaN(v))return;
  const ts=new Date().toLocaleString();
  if(type==='add'){budget+=v;history.push({type:'Add',value:v,timestamp:ts});}
  saveBudget();renderHistory();clearInput();
}
function openSubtract(){
  const modal=document.createElement('div');
  modal.className='modal';
  modal.innerHTML='<h3>'+(lang==='ar'?'Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©':'Select Category')+'</h3>'+
  categories.map(c=>`<button class="btn" onclick="doSubtract('${c}')">${c}</button>`).join('')+
  `<button class="btn" onclick="this.parentElement.remove()">Close</button>`;
  document.body.appendChild(modal);
  modal.style.display='block';
}
function doSubtract(cat){
  const v=parseFloat(inputEl.value);
  if(isNaN(v))return;
  const ts=new Date().toLocaleString();
  budget-=v;history.push({type:`Subtract (${cat})`,value:v,timestamp:ts});
  saveBudget();renderHistory();clearInput();
  document.querySelectorAll('.modal').forEach(m=>m.remove());
}
function saveBudget(){
  localStorage.setItem('budget',budget);
  localStorage.setItem('history',JSON.stringify(history));
  updateBudget();
}
function updateBudget(){
  document.getElementById('budget').textContent=`Budget: $${budget.toFixed(2)}`;
}
function clearHistory(){
  history=[];
  localStorage.setItem('history','[]');
  renderHistory();
}
function resetBudget(){
  budget=0;
  saveBudget();
}
function renderHistory(){
  historyEl.innerHTML='';
  history.slice().reverse().forEach(it=>{
    const d=document.createElement('div');
    d.textContent=`${it.timestamp} â€” ${it.type}: $${it.value.toFixed(2)}`;
    historyEl.appendChild(d);
  });
}

// ========== Theme ==========
function toggleMode(){
  const dark=document.body.classList.contains('dark-mode');
  document.body.classList.toggle('dark-mode',!dark);
  document.body.classList.toggle('light-mode',dark);
  localStorage.setItem('theme',dark?'light':'dark');
  modeBtn.textContent=dark?'ğŸŒ™':'â˜€ï¸';
}
if(localStorage.getItem('theme')==='dark'){
  document.body.classList.add('dark-mode');
  modeBtn.textContent='â˜€ï¸';
}else{document.body.classList.add('light-mode');}

// ========== Settings ==========
function openSettings(){renderSettings();settingsModal.style.display='block';overlay.style.display='block';}
function closeSettings(){settingsModal.style.display='none';overlay.style.display='none';}
overlay.onclick=()=>closeSettings();

function renderSettings(){
  document.getElementById('toggleRepeat').checked=featureSettings.repeat;
  document.getElementById('toggleClear').checked=featureSettings.clear;
  document.getElementById('toggleReset').checked=featureSettings.reset;
  const list=document.getElementById('categoryList');
  list.innerHTML='';
  categories.forEach((c,i)=>{
    const row=document.createElement('div');
    row.innerHTML=`${c} <button style="float:right;background:red;color:#fff;border:none;border-radius:6px;padding:2px 6px;" onclick="removeCategory(${i})">X</button>`;
    list.appendChild(row);
  });
}

function addCategory(){
  const val=document.getElementById('newCategoryInput').value.trim();
  if(val && !categories.includes(val)){
    categories.push(val);
    localStorage.setItem('categories',JSON.stringify(categories));
    renderSettings();
    document.getElementById('newCategoryInput').value='';
  }
}
function removeCategory(i){
  categories.splice(i,1);
  localStorage.setItem('categories',JSON.stringify(categories));
  renderSettings();
}

// ========== Language ==========
function toggleLanguage(){
  lang=lang==='en'?'ar':'en';
  localStorage.setItem('lang',lang);
  applyLanguage();
}
function applyLanguage(){
  const en={title:'Money Budgeter',settingsTitle:'Settings',languageLabel:'Language:',featuresLabel:'Features:',categoryLabel:'Custom Categories:',toggleRepeatLbl:'Show Repeat',toggleClearLbl:'Show Clear History',toggleResetLbl:'Show Reset',langBtn:'Switch to Arabic ğŸ‡¸ğŸ‡¦',historyLabel:'History'};
  const ar={title:'Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©',settingsTitle:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',languageLabel:'Ø§Ù„Ù„ØºØ©:',featuresLabel:'Ø§Ù„Ø®ØµØ§Ø¦Øµ:',categoryLabel:'Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©:',toggleRepeatLbl:'Ø¹Ø±Ø¶ Ø§Ù„ØªÙƒØ±Ø§Ø±',toggleClearLbl:'Ø¹Ø±Ø¶ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„',toggleResetLbl:'Ø¹Ø±Ø¶ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·',langBtn:'Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ğŸ‡¬ğŸ‡§',historyLabel:'Ø§Ù„Ø³Ø¬Ù„'};
  const t=lang==='ar'?ar:en;
  document.getElementById('title').textContent=t.title;
  document.getElementById('settingsTitle').textContent=t.settingsTitle;
  document.getElementById('languageLabel').textContent=t.languageLabel;
  document.getElementById('featuresLabel').textContent=t.featuresLabel;
  document.getElementById('categoryLabel').textContent=t.categoryLabel;
  document.getElementById('toggleRepeatLbl').textContent=t.toggleRepeatLbl;
  document.getElementById('toggleClearLbl').textContent=t.toggleClearLbl;
  document.getElementById('toggleResetLbl').textContent=t.toggleResetLbl;
  document.getElementById('langBtn').textContent=t.langBtn;
  document.getElementById('historyLabel').textContent=t.historyLabel;
  document.body.setAttribute('dir',lang==='ar'?'rtl':'ltr');
}
applyLanguage();

function viewCategoryTotals(){
  const totals=Object.fromEntries(categories.map(c=>[c,0]));
  history.forEach(h=>{
    const m=h.type.match(/^Subtract \((.+)\)$/);
    if(m&&totals[m[1]]!==undefined)totals[m[1]]+=h.value;
  });
  const cur='$';
  let html=`<h3>${lang==='ar'?'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ¦Ø§Øª':'Category Totals'}</h3>`;
  html+=categories.map(c=>`<div style="margin:6px 0;">${c}: ${cur}${totals[c].toFixed(2)}</div>`).join('');
  html+=`<button class="btn" onclick="document.querySelectorAll('.sleek-modal').forEach(m=>m.remove());overlay.style.display='none'">${lang==='ar'?'Ø¥ØºÙ„Ø§Ù‚':'Close'}</button>`;
  const modal=document.createElement('div');
  modal.className='modal sleek-modal';
  modal.innerHTML=html;
  document.body.appendChild(modal);
  modal.style.display='block';
  overlay.style.display='block';
}

updateBudget();
renderHistory();
</script>
</body>
</html>
