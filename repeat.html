<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Repeating · Money Budgeter</title>
<link rel="stylesheet" href="style.css" />
<style>
  .repeat-list-card{
    width:min(820px,94vw);
    margin:0 auto;
    padding:20px;
    border-radius:22px;
    background:var(--glass-light);
    border:1px solid var(--glass-border-light);
    box-shadow:0 12px 32px rgba(0,0,0,.12);
    backdrop-filter:blur(18px) saturate(140%);
    position:relative;
    overflow:hidden;
  }
  body.dark-mode .repeat-list-card{
    background:var(--glass-dark);
    border:1px solid var(--glass-border-dark);
    box-shadow:0 18px 42px rgba(0,0,0,.55);
  }
  .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .title{font-weight:900;color:#7fb4ff;letter-spacing:.2px}
  body.light-mode .title{color:#0a6bff}
  .icon-btn{
    width:40px;height:40px;border:none;border-radius:12px;
    background:rgba(13,27,56,.96);color:#fff;font-size:22px;font-weight:900;
    display:flex;align-items:center;justify-content:center;cursor:pointer;
    box-shadow:0 10px 26px rgba(10,20,40,.4);
    outline:none;
  }
  .icon-btn:focus-visible{ box-shadow:0 0 0 3px rgba(10,107,255,.5) }
  .icon-btn:hover{filter:brightness(1.1)}
  .list{display:grid;gap:10px;margin-top:8px}
  .item{
    display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;
    padding:12px 14px;border-radius:14px;
    background:rgba(245,248,255,.55);border:1px dashed rgba(160,180,220,.55);
    backdrop-filter:blur(8px)
  }
  body.dark-mode .item{background:rgba(16,28,58,.65);border-color:rgba(210,225,255,.16)}
  .empty{
    padding:18px;border-radius:16px;text-align:center;font-weight:700;opacity:.9;
    background:rgba(245,248,255,.55);border:1px solid rgba(160,180,220,.45)
  }
  body.dark-mode .empty{background:rgba(16,28,58,.65);border-color:rgba(210,225,255,.16)}
  .trash{
    background:#ef4444;color:#fff;border:none;border-radius:10px;padding:8px 12px;
    font-weight:900;cursor:pointer;box-shadow:0 4px 10px rgba(239,68,68,.35);
    outline:none;
  }
  .trash:focus-visible{ box-shadow:0 0 0 3px rgba(239,68,68,.45) }
  .sub{opacity:.8;font-size:.92rem;margin-top:2px}
</style>
</head>
<body>
  <div class="repeat-list-card">
    <div class="header">
      <button class="icon-btn" onclick="goBackOr('index.html')">←</button>
      <h2 class="title">Repeat</h2>
      <button class="icon-btn" title="Add" onclick="goTo('repeat_add.html')">＋</button>
    </div>

    <div id="container"></div>
  </div>

<script>
  /* ===== Theme Sync ===== */
  if (localStorage.getItem('theme') === 'dark') {
    document.body.classList.add('dark-mode');
  } else {
    document.body.classList.add('light-mode');
  }

  /* ===== Navigation Helpers (robust back) ===== */
  function goTo(path){ window.location.href = path; }
  function goBackOr(fallback){
    const ref = document.referrer;
    if (ref && !ref.includes(location.href)) { history.back(); }
    else { location.href = fallback; }
  }

  /* ===== List rendering ===== */
  function fmtEntry(e){
    const cur = localStorage.getItem('currency') || '$';
    const sign = (e.type||'add')==='add' ? '+' : '-';
    const parts = [];
    parts.push(`${sign}${cur}${(+e.amount||0).toFixed(2)}`);
    parts.push(e.time ? `@ ${e.time}` : '@ --:--');
    if (e.days?.length) parts.push(`days: ${e.days.join(', ')}`);
    if (e.calendarDays?.length) parts.push(`nums: ${e.calendarDays.join(', ')}`);
    if (e.months?.length) parts.push(`months: ${e.months.map(m=>m.slice(0,3)).join(', ')}`);
    if (e.date) parts.push(`date: ${e.date}`);
    return parts.join('  •  ');
  }

  function remove(id){
    const all = JSON.parse(localStorage.getItem('autoRenewals')) || [];
    const next = all.filter(x => x.id !== id);
    localStorage.setItem('autoRenewals', JSON.stringify(next));
    const applied = JSON.parse(localStorage.getItem('autoRenewalsApplied')) || {};
    if (applied[id]) { delete applied[id]; localStorage.setItem('autoRenewalsApplied', JSON.stringify(applied)); }
    render();
  }

  function render(){
    const root = document.getElementById('container');
    const all = JSON.parse(localStorage.getItem('autoRenewals')) || [];
    if (!all.length){
      root.innerHTML = `<div class="empty">No repeating transactions yet.</div>`;
      return;
    }
    const list = document.createElement('div');
    list.className = 'list';
    all.slice().reverse().forEach(e=>{
      const row = document.createElement('div');
      row.className = 'item';
      const left = document.createElement('div');
      left.innerHTML = `<div>${fmtEntry(e)}</div>`;
      if (!e.days?.length && !e.calendarDays?.length && !e.months?.length && !e.date){
        const s = document.createElement('div'); s.className='sub'; s.textContent = 'Runs every day (no filters set)';
        left.appendChild(s);
      }
      const del = document.createElement('button');
      del.className='trash'; del.textContent='Delete'; del.onclick = ()=>remove(e.id);
      row.appendChild(left); row.appendChild(del); list.appendChild(row);
    });
    root.innerHTML=''; root.appendChild(list);
  }
  render();
</script>
</body>
</html>
