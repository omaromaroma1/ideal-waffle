<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Money Budgeter — Repeats</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0b1426" />
  <link rel="apple-touch-icon" href="/icon-192.png" />
  <link rel="manifest" href="/manifest.json" />
  <style>
    :root{ --bg:#0b1426; --card:#0f1f3a; --border:#1e335a; --text:#eaf0ff; --muted:#a8b3cf; --accent:#0a6bff; --chip:#142646; }
    *{box-sizing:border-box} html{-webkit-text-size-adjust:100%}
    body{margin:0;padding-top:env(safe-area-inset-top);background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
    .topbar{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:rgba(8,16,32,.6);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .title{font-weight:700}
    .navlink{color:#cfd6e6;text-decoration:none}
    .iconbtn{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;background:#10254a;color:#fff;border:1px solid var(--border);cursor:pointer}
    .container{padding:18px;max-width:760px;margin:0 auto}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:12px}
    .empty{color:var(--muted);font-size:14px}
    .list{display:flex;flex-direction:column;gap:10px}
    .row{display:flex;align-items:center;justify-content:space-between;background:#0e1c36;border:1px solid var(--border);border-radius:12px;padding:12px}
    .badges{display:flex;gap:8px;flex-wrap:wrap}
    .badge{background:var(--chip);border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px;color:#cfd6e6}
    .amt{font-weight:800}
    /* inline menu */
    #mbMenu{position:absolute;display:none;z-index:99999;min-width:180px}
    #mbMenu .sheet{background:#0e1c36;border:1px solid var(--border);border-radius:12px;box-shadow:0 12px 28px rgba(0,0,0,.35);overflow:hidden}
    #mbMenu .item{display:block;width:100%;text-align:left;padding:12px 14px;background:transparent;color:var(--text);border:0;font-size:14px;cursor:pointer}
    #mbMenu .item:hover{background:#142646}
    #mbMenu .sep{height:1px;background:var(--border)}
  </style>
</head>
<body>
  <div class="topbar">
    <a class="navlink" href="index.html">Back</a>
    <div class="title">Repeats</div>
    <button class="iconbtn" id="plusBtn" aria-label="Add">+</button>
  </div>

  <div class="container">
    <div class="card">
      <div id="list" class="list"></div>
      <div id="empty" class="empty" style="display:none">No repeat entries yet.</div>
    </div>
  </div>

  <!-- dropdown under the + -->
  <div id="mbMenu">
    <div class="sheet">
      <button class="item" data-go="repeat">Repeat</button>
      <div class="sep"></div>
      <button class="item" data-go="one-time">One time</button>
    </div>
  </div>

  <script>
    // Helpers
    const get = (k, d) => { try { return JSON.parse(localStorage.getItem(k)) ?? d; } catch { return d; } };
    const set = (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} };

    // Render existing repeats
    function render() {
      const data = get('mb:repeatEntries', []);
      const list = document.getElementById('list');
      const empty = document.getElementById('empty');
      list.innerHTML = '';
      if (!data.length) { empty.style.display='block'; return; }
      empty.style.display='none';
      data.forEach(item => {
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <div>
            <div class="amt">${item.type === 'subtract' ? '−' : '+'}$${(item.amount||0).toFixed(2)}</div>
            <div style="font-size:12px;color:#a8b3cf">at ${item.time || '—'}</div>
          </div>
          <div class="badges">
            ${ (item.days||[]).map(d=>`<span class="badge">${d}</span>`).join('') }
          </div>`;
        list.appendChild(row);
      });
    }

    // Menu logic
    (function(){
      const plus = document.getElementById('plusBtn');
      const menu = document.getElementById('mbMenu');

      function pos() {
        const r = plus.getBoundingClientRect();
        menu.style.top = (r.bottom + 6 + window.scrollY) + 'px';
        menu.style.left = (r.right - 180 + window.scrollX) + 'px';
      }
      plus.addEventListener('click', (e)=>{
        e.preventDefault(); e.stopPropagation();
        pos(); menu.style.display='block';
        const close = (ev)=>{ if(!menu.contains(ev.target) && ev.target !== plus){ menu.style.display='none'; document.removeEventListener('click', close, true); } };
        setTimeout(()=>document.addEventListener('click', close, true),0);
      });
      menu.addEventListener('click', (e)=>{
        const btn = e.target.closest('.item'); if(!btn) return;
        window.location.href = btn.dataset.go === 'repeat' ? 'repeat_add.html' : 'one_time_add.html';
      });
    })();

    render();
  </script>
</body>
</html>
