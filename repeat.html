<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Repeat Transactions</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px; margin: 0; transition: background 0.3s, color 0.3s;
    }
    body.light-mode { background: #ffffff; color: #003366; }
    body.dark-mode  { background: #000000; color: #eeeeee; }

    h1 { text-align: center; margin-bottom: 20px; color: #007bff; }

    label { display: block; margin: 12px 0 6px; }

    input[type="number"], input[type="time"], input[type="date"] {
      width: 100%; padding: 12px; font-size: 16px; border-radius: 12px;
      border: 1px solid #ccc; margin-bottom: 15px;
    }

    .bubble-group { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 16px; }
    .bubble {
      padding: 10px 15px; border-radius: 20px; border: none;
      background-color: #007bff; color: white; cursor: pointer; font-size: 14px;
      user-select: none;
    }
    .bubble.selected { background-color: #0056b3; }

    .toggle-group { display: flex; justify-content: center; gap: 12px; margin: 10px 0 20px; }
    .toggle-group .bubble { background: #9bbcf5; color: #00285c; }
    .toggle-group .bubble.selected { background: #007bff; color: #fff; }

    .collapsible {
      background-color: #007bff; color: white; cursor: pointer; padding: 10px;
      width: 100%; border: none; text-align: left; font-size: 16px;
      border-radius: 12px; margin: 10px 0;
    }
    .content { padding: 10px 10px 5px; display: none; border-radius: 12px; background: #f2f7ff; }

    button.save-btn {
      width: 100%; padding: 12px; font-size: 16px; border: none; border-radius: 12px;
      background-color: #007bff; color: white; cursor: pointer; margin-top: 8px;
    }
    .back-button { margin-top: 10px; background-color: #888; }
  </style>
</head>
<body>
  <h1>Repeat Transactions</h1>

  <label for="amount">Amount</label>
  <input type="number" id="amount" placeholder="Enter amount" />

  <label for="time">Time</label>
  <input type="time" id="time" />

  <label>Transaction Type</label>
  <div class="toggle-group" id="typeGroup">
    <div class="bubble" data-type="add">Add</div>
    <div class="bubble" data-type="subtract">Subtract</div>
  </div>

  <label>Days of the Week</label>
  <div class="bubble-group" id="dayButtons">
    <div class="bubble" data-value="Sunday">Sun</div>
    <div class="bubble" data-value="Monday">Mon</div>
    <div class="bubble" data-value="Tuesday">Tue</div>
    <div class="bubble" data-value="Wednesday">Wed</div>
    <div class="bubble" data-value="Thursday">Thu</div>
    <div class="bubble" data-value="Friday">Fri</div>
    <div class="bubble" data-value="Saturday">Sat</div>
  </div>

  <button class="collapsible" id="monthsToggle">Select Months</button>
  <div class="content" id="monthsContent">
    <div class="bubble-group" id="monthButtons">
      <div class="bubble" data-value="January">Jan</div>
      <div class="bubble" data-value="February">Feb</div>
      <div class="bubble" data-value="March">Mar</div>
      <div class="bubble" data-value="April">Apr</div>
      <div class="bubble" data-value="May">May</div>
      <div class="bubble" data-value="June">Jun</div>
      <div class="bubble" data-value="July">Jul</div>
      <div class="bubble" data-value="August">Aug</div>
      <div class="bubble" data-value="September">Sep</div>
      <div class="bubble" data-value="October">Oct</div>
      <div class="bubble" data-value="November">Nov</div>
      <div class="bubble" data-value="December">Dec</div>
    </div>
  </div>

  <label>Specific Calendar Days (tap numbers)</label>
  <div class="bubble-group" id="dateButtons"></div>

  <label>Specific Date (optional)</label>
  <input type="date" id="date" />

  <button class="save-btn" id="saveButton">Save</button>
  <button class="save-btn back-button" onclick="window.location.href='index.html'">‚Üê Back</button>

  <script>
    // Theme
    const mode = localStorage.getItem('theme');
    if (mode === 'dark') document.body.classList.add('dark-mode'); else document.body.classList.add('light-mode');

    // Build 1..31 bubbles
    const dateButtons = document.getElementById('dateButtons');
    for (let i=1;i<=31;i++){
      const b = document.createElement('div');
      b.className = 'bubble';
      b.dataset.value = String(i);
      b.textContent = i;
      dateButtons.appendChild(b);
    }

    // Toggle helpers
    function toggleSelected(e) {
      if (e.target.classList.contains('bubble')) {
        e.target.classList.toggle('selected');
        saveDraft();
      }
    }
    document.getElementById('dayButtons').addEventListener('click', toggleSelected);
    document.getElementById('monthButtons').addEventListener('click', toggleSelected);
    document.getElementById('dateButtons').addEventListener('click', toggleSelected);

    // Add/Subtract toggle
    document.querySelectorAll('#typeGroup .bubble').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('#typeGroup .bubble').forEach(b=>b.classList.remove('selected'));
        btn.classList.add('selected');
        saveDraft();
      });
    });

    // Collapsible months
    const monthsToggle = document.getElementById('monthsToggle');
    const monthsContent = document.getElementById('monthsContent');
    monthsToggle.addEventListener('click', ()=>{
      monthsContent.style.display = monthsContent.style.display === 'block' ? 'none' : 'block';
    });

    // Draft persistence
    const DRAFT_KEY = 'repeatDraft';
    function saveDraft() {
      const draft = {
        amount: document.getElementById('amount').value,
        time: document.getElementById('time').value,
        type: document.querySelector('#typeGroup .bubble.selected')?.dataset.type || '',
        days: [...document.querySelectorAll('#dayButtons .bubble.selected')].map(b=>b.dataset.value),
        months: [...document.querySelectorAll('#monthButtons .bubble.selected')].map(b=>b.dataset.value),
        calendarDays: [...document.querySelectorAll('#dateButtons .bubble.selected')].map(b=>b.dataset.value),
        date: document.getElementById('date').value
      };
      localStorage.setItem(DRAFT_KEY, JSON.stringify(draft));
    }

    function restoreDraft() {
      const raw = localStorage.getItem(DRAFT_KEY);
      if (!raw) return;
      try {
        const d = JSON.parse(raw);
        document.getElementById('amount').value = d.amount || '';
        document.getElementById('time').value = d.time || '';
        if (d.type) {
          const t = document.querySelector(`#typeGroup .bubble[data-type="${d.type}"]`);
          if (t) t.classList.add('selected');
        }
        (d.days||[]).forEach(v=>{
          const el = document.querySelector(`#dayButtons .bubble[data-value="${v}"]`);
          if (el) el.classList.add('selected');
        });
        (d.months||[]).forEach(v=>{
          const el = document.querySelector(`#monthButtons .bubble[data-value="${v}"]`);
          if (el) el.classList.add('selected');
        });
        (d.calendarDays||[]).forEach(v=>{
          const el = document.querySelector(`#dateButtons .bubble[data-value="${v}"]`);
          if (el) el.classList.add('selected');
        });
        document.getElementById('date').value = d.date || '';
      } catch {}
    }

    document.getElementById('amount').addEventListener('input', saveDraft);
    document.getElementById('time').addEventListener('input', saveDraft);
    document.getElementById('date').addEventListener('input', saveDraft);

    restoreDraft();

    // Save
    document.getElementById('saveButton').addEventListener('click', function () {
      const amount = parseFloat(document.getElementById('amount').value) || 0;
      const time = document.getElementById('time').value || '';
      const type = document.querySelector('#typeGroup .bubble.selected')?.dataset.type || 'add';
      const days = [...document.querySelectorAll('#dayButtons .bubble.selected')].map(b=>b.dataset.value);
      const months = [...document.querySelectorAll('#monthButtons .bubble.selected')].map(b=>b.dataset.value);
      const calendarDays = [...document.querySelectorAll('#dateButtons .bubble.selected')].map(b=>b.dataset.value);
      const date = document.getElementById('date').value || null;

      const entry = {
        id: 'r' + Date.now() + Math.random().toString(36).slice(2),
        amount, time, type, days, months, calendarDays, date
      };

      const all = JSON.parse(localStorage.getItem('autoRenewals')) || [];
      all.push(entry);
      localStorage.setItem('autoRenewals', JSON.stringify(all));

      // Clear draft after saving
      localStorage.removeItem(DRAFT_KEY);

      window.location.href = 'index.html';
    });
  </script>
</body>
</html>
