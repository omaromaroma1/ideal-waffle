<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Money Budgeter â€” Repeats</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0b1426" />
  <link rel="apple-touch-icon" href="/icon-192.png" />
  <link rel="manifest" href="/manifest.json" />
  <style>
    :root{
      --bg:#0b1426; --card:#0f1f3a; --border:#1e335a;
      --text:#eaf0ff; --muted:#a8b3cf; --accent:#0a6bff;
      --chip:#142646; --chip-on:#0a6bff;
    }
    *{box-sizing:border-box} html{-webkit-text-size-adjust:100%}
    body{margin:0;padding-top:env(safe-area-inset-top);background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
    .topbar{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;
      padding:14px 16px;background:rgba(8,16,32,.6);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .title{font-weight:700}
    .iconbtn{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;background:#10254a;color:#fff;border:1px solid var(--border);cursor:pointer}
    .container{padding:18px;max-width:680px;margin:0 auto}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:12px}
    .empty{color:var(--muted);font-size:14px}
    /* inline menu */
    #mbMenu{position:absolute;display:none;z-index:99999;min-width:180px}
    #mbMenu .sheet{background:#0e1c36;border:1px solid var(--border);border-radius:12px;box-shadow:0 12px 28px rgba(0,0,0,.35);overflow:hidden}
    #mbMenu .item{display:block;width:100%;text-align:left;padding:12px 14px;background:transparent;color:var(--text);border:0;font-size:14px;cursor:pointer}
    #mbMenu .item:hover{background:#142646}
    #mbMenu .sep{height:1px;background:var(--border)}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="title">Repeats</div>
    <!-- IMPORTANT: this id is what the script hooks to -->
    <button class="iconbtn" id="plusBtn" aria-label="Add">+</button>
  </div>

  <div class="container">
    <div class="card"><div class="empty">No repeat entries yet.</div></div>
  </div>

  <!-- small dropdown menu under the + -->
  <div id="mbMenu">
    <div class="sheet">
      <button class="item" data-go="repeat">Repeat</button>
      <div class="sep"></div>
      <button class="item" data-go="one-time">One time</button>
    </div>
  </div>

  <script>
    // Prevent zoom on mobile
    (function(){
      document.addEventListener('gesturestart', e => e.preventDefault(), {passive:false});
      let lastTouch=0;
      document.addEventListener('touchend', e => { const now=Date.now(); if(now-lastTouch<=300){e.preventDefault();} lastTouch=now; }, {passive:false});
      document.addEventListener('wheel', e => { if (e.ctrlKey) e.preventDefault(); }, {passive:false});
    })();

    // Menu logic (intercepts the + click so it doesn't auto-navigate)
    (function(){
      const plus = document.getElementById('plusBtn');
      const menu = document.getElementById('mbMenu');

      function positionMenu(){
        const r = plus.getBoundingClientRect();
        const top = Math.max(0, r.bottom + 6 + window.scrollY);
        const left = Math.max(8, (r.right - 180) + window.scrollX);
        menu.style.top = top + 'px';
        menu.style.left = left + 'px';
      }

      plus.addEventListener('click', (e)=>{
        e.preventDefault();
        e.stopPropagation();        // <-- this prevents any default link behavior
        positionMenu();
        menu.style.display = 'block';
        const close = (ev)=>{
          if (!menu.contains(ev.target) && ev.target !== plus) {
            menu.style.display = 'none';
            document.removeEventListener('click', close, true);
          }
        };
        setTimeout(()=>document.addEventListener('click', close, true), 0);
      });

      menu.addEventListener('click', (e)=>{
        const btn = e.target.closest('.item'); if(!btn) return;
        if (btn.dataset.go === 'repeat')  window.location.href = 'repeat_add.html';
        else                               window.location.href = 'one_time_add.html';
      });
    })();
  </script>
</body>
</html>
