<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#000000" />
  <link rel="apple-touch-icon" href="/icon-192.png" />
  <link rel="manifest" href="/manifest.json" />
  <title>Money Budgeter â€” One time</title>
  <link rel="stylesheet" href="/style.css" />
  <style>
    html{-webkit-text-size-adjust:100%}
    input, select, textarea { font-size: 16px; }
    .topbar{position: sticky; top:0; z-index:10; display:flex; align-items:center; justify-content:space-between; padding:14px 16px; background: rgba(0,0,0,.35); backdrop-filter: blur(8px); border-bottom:1px solid #1c1f25; color:#e8ecf5}
    .container{padding:18px; max-width:680px; margin:0 auto;}
    .card{background:#121317; border:1px solid #1f232b; border-radius:16px; padding:16px; margin-bottom:16px; color:#e8ecf5}
    .chips{display:flex; gap:10px; flex-wrap:wrap}
    .chip{ padding:10px 12px; border-radius:999px; background:#1a1c22; border:1px solid #2a2f39; cursor:pointer; user-select:none; font-size:14px; color:#cfd6e6}
    .chip.active{ background:#0a6bff; border-color:#0a6bff; color:#fff }
    .btn{ width:100%; padding:14px; border-radius:12px; background:#0a6bff; border:none; color:#fff; font-weight:700; font-size:16px; cursor:pointer;}
    label{display:block; font-size:13px; color:#aeb4c0; margin-bottom:6px}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="title">One-time Entry</div>
    <a href="repeat.html" style="color:#cfd6e6;text-decoration:none">Back</a>
  </div>

  <div class="container">
    <div class="card">
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px">
        <div>
          <label>Amount</label>
          <input id="amount" type="text" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" placeholder="0.00" autocomplete="off" />
        </div>
        <div>
          <label>Type</label>
          <div class="chips" role="group" aria-label="Add/Subtract">
            <div class="chip active" data-type="add">Add</div>
            <div class="chip" data-type="subtract">Subtract</div>
          </div>
        </div>
      </div>
      <div style="margin-top:12px">
        <label>Note (optional)</label>
        <input id="note" type="text" placeholder="e.g., One-time bill" />
      </div>
    </div>

    <div class="card">
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px">
        <div>
          <label>Specific Date <span style="color:#ff758f">*</span></label>
          <input id="specificDate" type="date" required />
        </div>
        <div>
          <label>Time (optional)</label>
          <input id="time" type="time" />
        </div>
      </div>
    </div>

    <div class="card">
      <button class="btn" id="saveBtn">Save</button>
    </div>
  </div>

  <script src="/pwa-bridge.js"></script>
  <script>
  // No zoom
  (function(){
    document.addEventListener('gesturestart', e => e.preventDefault(), {passive:false});
    let lastTouch=0;
    document.addEventListener('touchend', e => { const now=Date.now(); if (now-lastTouch<=300){e.preventDefault();} lastTouch=now; }, {passive:false});
    document.addEventListener('wheel', e => { if (e.ctrlKey) e.preventDefault(); }, {passive:false});
  })();

  // Chips selection
  document.addEventListener('click', function(e){
    const chip = e.target.closest('.chip');
    if (!chip) return;
    const group = chip.parentElement;
    group.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
    chip.classList.add('active');
  });

  // Save (draft example; wire to your storage as needed)
  document.getElementById('saveBtn').addEventListener('click', ()=>{
    const type = document.querySelector('.chips .chip.active')?.getAttribute('data-type') || 'add';
    const val = (document.getElementById('amount').value||'').replace(',', '.');
    const note = document.getElementById('note').value||'';
    const date = document.getElementById('specificDate').value;
    const time = document.getElementById('time').value||null;
    if (!date){ alert('Please pick a date.'); return; }
    const payload = { mode:'one-time', type, value: parseFloat(val)||0, note, date, time };
    try { localStorage.setItem('mb:lastAddDraft', JSON.stringify(payload)); } catch(e){}
    alert('Saved draft: ' + JSON.stringify(payload));
    // window.history.back();
  });

  // Prevent iOS zoom on inputs
  document.querySelectorAll('input, select, textarea').forEach(el=>{ el.style.fontSize='16px'; });
  </script>
</body>
</html>
