<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Add Repeat · Money Budgeter</title>
<link rel="stylesheet" href="style.css" />
<style>
  .repeat-box{
    width:min(820px,94vw);margin:0 auto;padding:20px;border-radius:22px;
    background:var(--glass-light);border:1px solid var(--glass-border-light);
    box-shadow:0 12px 32px rgba(0,0,0,.12);backdrop-filter:blur(18px) saturate(140%);
    position:relative; overflow:hidden;
  }
  body.dark-mode .repeat-box{
    background:var(--glass-dark);border:1px solid var(--glass-border-dark);
    box-shadow:0 18px 42px rgba(0,0,0,.55);
  }
  .header-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .page-title{font-weight:900;letter-spacing:.2px;color:#7fb4ff}
  body.light-mode .page-title{color:#0a6bff}
  .icon-btn{width:40px;height:40px;border:none;border-radius:12px;background:rgba(13,27,56,.96);color:#fff;font-size:22px;font-weight:900;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 10px 26px rgba(10,20,40,.4);outline:none}
  .icon-btn:hover{filter:brightness(1.1)}

  .field{margin:10px 0 14px}
  .label{font-weight:800;margin:0 0 6px 2px}
  .input{width:100%;padding:12px 14px;border-radius:14px;border:1px solid rgba(200,210,230,.7);background:rgba(255,255,255,.7);color:inherit;backdrop-filter:blur(8px);outline:none}
  body.dark-mode .input{border-color:rgba(210,225,255,.18);background:rgba(16,28,58,.55);color:#fff}

  .chip-row{display:flex;flex-wrap:wrap;gap:10px}
  .chip{padding:10px 14px;border-radius:999px;background:rgba(13,27,56,.92);color:#fff;font-weight:800;cursor:pointer;user-select:none;box-shadow:0 8px 22px rgba(10,20,40,.35);transition:transform .12s, box-shadow .18s, background .18s}
  .chip:hover{transform:translateY(-1px);box-shadow:0 12px 26px rgba(15,30,70,.45)}
  .chip.selected{background:rgba(18,36,78,1)}

  .btn-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
  .btn{flex:1 1 260px;padding:12px;border:none;border-radius:14px;font-weight:900;background:rgba(13,27,56,.96);color:#fff;cursor:pointer;box-shadow:0 10px 26px rgba(10,20,40,.40);backdrop-filter:blur(10px) saturate(150%);transition:transform .14s, box-shadow .2s, background .2s}
  .btn:hover{transform:translateY(-1px);box-shadow:0 14px 32px rgba(10,20,40,.55);background:rgba(18,36,78,1)}
</style>
</head>
<body>
  <div class="repeat-box">
    <div class="header-row">
      <button class="icon-btn" onclick="goBackOr('repeat.html')">←</button>
      <h2 class="page-title">Add Repeat</h2>
      <span style="width:40px;height:40px"></span>
    </div>

    <div class="field">
      <div class="label">Amount</div>
      <input type="number" id="amount" class="input" placeholder="Enter amount" />
    </div>

    <div class="field">
      <div class="label">Time</div>
      <input type="time" id="time" class="input" />
    </div>

    <div class="field">
      <div class="label">Transaction Type</div>
      <div class="chip-row" id="typeGroup">
        <div class="chip" data-type="add">Add</div>
        <div class="chip" data-type="subtract">Subtract</div>
      </div>
    </div>

    <div class="field">
      <div class="label">Days of the Week</div>
      <div class="chip-row" id="dayButtons">
        <div class="chip" data-value="Sunday">Sun</div><div class="chip" data-value="Monday">Mon</div>
        <div class="chip" data-value="Tuesday">Tue</div><div class="chip" data-value="Wednesday">Wed</div>
        <div class="chip" data-value="Thursday">Thu</div><div class="chip" data-value="Friday">Fri</div>
        <div class="chip" data-value="Saturday">Sat</div>
      </div>
    </div>

    <div class="field">
      <div class="label">Specific Date (optional)</div>
      <input type="date" id="date" class="input" />
    </div>

    <div class="btn-row">
      <button class="btn" id="saveBtn">Save</button>
    </div>
  </div>

<script>
  /* Theme sync */
  if(localStorage.getItem('theme')==='dark'){document.body.classList.add('dark-mode');}
  else{document.body.classList.add('light-mode');}

  /* Robust back helper (same behavior as repeat.html) */
  function goTo(path){ window.location.href = path; }
  function goBackOr(fallback){
    const ref = document.referrer;
    if (ref && !ref.includes(location.href)) { history.back(); }
    else { location.href = fallback; }
  }

  /* Chip selection */
  function toggleChip(e){
    const el=e.target;
    if(el.classList.contains('chip')){
      if(el.dataset.type){           // type chips are single-select
        document.querySelectorAll('#typeGroup .chip').forEach(x=>x.classList.remove('selected'));
        el.classList.add('selected');
      }else{                          // day chips are multi-select
        el.classList.toggle('selected');
      }
      saveDraft();
    }
  }
  document.getElementById('typeGroup').addEventListener('click',toggleChip);
  document.getElementById('dayButtons').addEventListener('click',toggleChip);

  /* Draft (so input survives accidental nav) */
  const DRAFT_KEY='repeatDraft';
  function draftFromUI(){
    return {
      amount:document.getElementById('amount').value,
      time:document.getElementById('time').value,
      type:document.querySelector('#typeGroup .chip.selected')?.dataset.type||'',
      days:[...document.querySelectorAll('#dayButtons .chip.selected')].map(b=>b.dataset.value),
      date:document.getElementById('date').value
    };
  }
  function saveDraft(){ localStorage.setItem(DRAFT_KEY,JSON.stringify(draftFromUI())); }
  function restoreDraft(){
    const raw=localStorage.getItem(DRAFT_KEY); if(!raw) return;
    try{
      const d=JSON.parse(raw);
      document.getElementById('amount').value=d.amount||'';
      document.getElementById('time').value=d.time||'';
      if(d.type){ document.querySelector(`#typeGroup .chip[data-type="${d.type}"]`)?.classList.add('selected'); }
      (d.days||[]).forEach(v=>document.querySelector(`#dayButtons .chip[data-value="${v}"]`)?.classList.add('selected'));
      document.getElementById('date').value=d.date||'';
    }catch{}
  }
  ['amount','time','date'].forEach(id=>document.getElementById(id).addEventListener('input',saveDraft));
  restoreDraft();

  /* Save */
  function saveEntry(e){
    const all=JSON.parse(localStorage.getItem('autoRenewals'))||[];
    all.push(e); localStorage.setItem('autoRenewals',JSON.stringify(all));
  }
  document.getElementById('saveBtn').addEventListener('click',()=>{
    const d=draftFromUI();
    const entry={
      id:'r'+Date.now()+Math.random().toString(36).slice(2),
      amount:+d.amount||0, time:d.time||'', type:d.type||'add',
      days:d.days||[], date:d.date||null
    };
    saveEntry(entry);
    localStorage.removeItem(DRAFT_KEY);
    goTo('repeat.html');
  });
</script>
</body>
</html>
